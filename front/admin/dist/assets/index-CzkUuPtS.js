import{c as b}from"./config-CJ0lGJJu.js";import{k as n,y as X,r as l,fy as Y,o as p,c as G,l as v,d as s,w as c,N as R,h,F as Z,g as ee,i as T,f as C,t as M,M as u,fz as ae}from"./index-Dj8CxrJe.js";import te from"./addGroup-Bwhwlqhh.js";import oe from"./addConfig-B66IZLyV.js";import ne from"./manageConfig-CLbFGRoK.js";import"./configDefine-CjGFkmcf.js";const se={class:"lg:flex justify-between"},le={class:"ma-content-block p-5 h-full lg:w-1/2"},ce={key:0,class:"ma-content-block p-5 h-full lg:w-1/2 lg:ml-3 mt-3 lg:mt-0"},ue={class:"mb-2"},ie={class:"text-red-500 underline font-black"},re={class:"text-red-500"},pe={name:"setting:config"},ke=Object.assign(pe,{setup(de){const w=n(!1),m=n("0-1"),x=n(""),r=n({name:""}),g=n(),S=n(),N=n(),y=n([]),V=n([]),k=n([]),D=n(!1),U=t=>{const a=t.split("-")[1];if(a==1||a==2){u.info("该配置为系统核心配置，无法删除");return}r.value=k.value.find(f=>f.id==a),D.value=!0},F=t=>{const a=t.split("-");g.value[a[0]].init(),m.value=t},d=async()=>{w.value=!1;const t=await b.getConfigGroupList();k.value=t.data,await Promise.all(k.value.map(async a=>{y.value[a.id]={},V.value[a.id]=[],await L(a.id)})),w.value=!0},L=async t=>{const a={group_id:t,orderBy:"sort",orderType:"desc"},f=await b.getConfigList(a);let _={};V.value[t]=f.data.map(e=>{let i={title:e.name,dataIndex:e.key,formType:e.input_type,dict:{},labelWidth:"120px",extra:e.remark,tooltip:e.key};if(["select","radio","checkbox"].includes(e.input_type)&&(i.dict={data:e.config_select_data}),e.input_type==="switch")switch(typeof e.value){case"string":i.checkedValue="true",i.uncheckedValue="false";break;case"number":i.checkedValue=1,i.uncheckedValue=0;break}return e.input_type==="key-value"&&(e.value=JSON.parse(e.value)),/^\[/.test(e.value)&&/\]$/.test(e.value)&&e.input_type==="checkbox"?e.value=JSON.parse(e.value):e.value&&e.value.toString().indexOf(",")>-1&&e.input_type==="checkbox"&&(e.value=e.value.split(",")),_[e.key]=e.value,i}),y.value[t]=_},O=()=>{S.value.open(m.value.split("-")[1])},A=()=>N.value.open(),j=t=>{if(t){u.success("配置组保存成功"),d();return}u.success("配置组保存失败")},J=t=>{if(t){u.success("配置添加成功"),d();return}u.success("配置添加失败")},K=async t=>{if(x.value!==r.value.name){u.error("输入错误，验证失败"),t(!1);return}(await b.deleteConfigGroup({id:r.value.id})).success&&(u.success("配置删除成功"),r.value={},d(),t(!0))},z=async t=>{if(!ae("setting:config:update")){u.info("没有权限修改配置");return}const a=await b.updateByKeys(t);a.success&&(u.success(a.message),d())};return d(),X(()=>g.value&&g.value[0].init()),(t,a)=>{const f=l("icon-plus"),_=l("a-button"),e=l("a-tooltip"),i=l("icon-settings"),$=l("a-space"),E=l("ma-form"),I=l("a-tab-pane"),P=l("a-tabs"),W=l("a-input"),q=l("a-modal"),B=Y("auth");return p(),G("div",se,[v("div",le,[s(P,{type:"rounded","active-key":m.value,"onUpdate:activeKey":a[0]||(a[0]=o=>m.value=o),onDelete:U,onChange:F,updateable:!0,"auto-switch":"",editable:!0},{extra:c(()=>[s($,null,{default:c(()=>[s(e,{content:"添加组"},{default:c(()=>[R((p(),h(_,{shape:"round",onClick:A,type:"primary"},{icon:c(()=>[s(f)]),_:1})),[[B,["setting:config:save"]]])]),_:1}),s(e,{content:"管理该组配置"},{default:c(()=>[R((p(),h(_,{shape:"round",onClick:O,type:"primary"},{icon:c(()=>[s(i)]),_:1})),[[B,["setting:config:index"]]])]),_:1})]),_:1})]),default:c(()=>[(p(!0),G(Z,null,ee(k.value,(o,H)=>(p(),h(I,{key:`${H}-${o.id}`,title:o.name},{default:c(()=>[w.value?(p(),h(E,{key:0,modelValue:y.value[o.id],"onUpdate:modelValue":Q=>y.value[o.id]=Q,columns:V.value[o.id],onSubmit:z,class:"mt-3",ref_for:!0,ref_key:"maFormRef",ref:g},null,8,["modelValue","onUpdate:modelValue","columns"])):T("",!0)]),_:2},1032,["title"]))),128))]),_:1},8,["active-key"])]),t.$common.auth(["setting:config:save"])?(p(),G("div",ce,[s(oe,{onSuccess:J})])):T("",!0),s(q,{visible:D.value,"onUpdate:visible":a[2]||(a[2]=o=>D.value=o),type:"warning","on-before-ok":K},{title:c(()=>[C("危险操作")]),default:c(()=>[v("div",ue,[C(" 确定要删除 "),v("span",ie,M(r.value.name),1),C(" 配置组吗？ ")]),v("div",null,[C(" 此操作会删除组和所属组配置项，如果执行请在下面输入框输入："),v("span",re,M(r.value.name),1)]),s(W,{placeholder:`请输入 ${r.value.name}`,class:"mt-2",modelValue:x.value,"onUpdate:modelValue":a[1]||(a[1]=o=>x.value=o)},null,8,["placeholder","modelValue"])]),_:1},8,["visible"]),s(te,{ref_key:"addGroupRef",ref:N,onSuccess:j},null,512),s(ne,{ref_key:"manageConfigRef",ref:S},null,512)])}}});export{ke as default};
