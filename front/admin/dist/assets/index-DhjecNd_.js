import{k as r,b as T,S as D,X as u,c as R,h,i as _,w as q,e as f,r as i,o as c,d as A,M as O}from"./index-Dj8CxrJe.js";const S={class:"ma-content-block lg:flex justify-between p-4"},B={name:"test:crontab"},V=Object.assign(B,{setup(I){const g=r(),l=r(!1),{currentRoute:v}=T(),w=v.value;r("status");const y=(e={})=>u({url:"setting"+w.path,method:"get",params:e});let d=r({}),m=r([]),o=r(0);const k=e=>e.view_type==="text"?"input":e.view_type==="date"&&e.options.range?"range":e.view_type,b=e=>{let a={};switch(e.component_type){case 1:a.viewType="modal";break;case 2:a.viewType="drawer";break;case 3:a.viewType="tag",e.options.tag_id&&(a.tagId=e.options.tag_id),e.options.tag_name&&(a.tagName=e.options.tag_name),e.options.tag_view_name&&(a.titleDataIndex=e.options.tag_view_name);break}return a.width=600,a};y().then(e=>{if(e.success){console.log(e.data.id),o.value=e.data.id,e.data.columns.forEach(t=>{m.value.push({title:t.column_comment,formType:k(t),dataIndex:t.column_name,addDisplay:t.is_insert===2,editDisplay:t.is_edit===2,hide:t.is_list===1,search:t.is_query===2,commonRules:t.is_required===2?{required:!0,message:"请输入"+t.column_comment}:null,dict:t.dict_type?{name:t.dict_type,props:{label:"title",value:"key"},translation:!0}:null,...t.options})});let a=[];e.data.generate_menus&&(a=e.data.generate_menus.split(",")),d=D({id:e.data.table_name,rowSelection:{showCheckedAll:!0},pk:"id",operationColumn:!0,operationColumnWidth:160,formOption:b(e.data),api:(t={})=>u({url:"setting/autoform/index/"+e.data.id,method:"get",params:t}),recycleApi:(t={})=>u({url:"setting/autoform/recycle/"+e.data.id,method:"get",params:t}),add:{show:a.includes("save"),api:(t={})=>u({url:"setting/autoform/save/"+e.data.id,method:"post",data:t}),auth:["setting:autoform:"+o.value+":save"]},edit:{show:a.includes("update"),api:(t,s={})=>u({url:"setting/autoform/update/"+e.data.id+"/"+t,method:"put",data:s}),auth:["setting:autoform:"+o.value+":update"]},delete:{show:a.includes("delete"),api:t=>u({url:"setting/autoform/delete/"+e.data.id,method:"delete",data:t}),auth:["setting:autoform:"+o.value+":delete"],realApi:t=>u({url:"setting/autoform/realDelete/"+e.data.id,method:"delete",data:t}),realAuth:["setting:autoform:"+o.value+":realDeletes"]},recovery:{show:a.includes("recycle"),api:t=>u({url:"setting/autoform/recovery/"+e.data.id,method:"put",data:t}),auth:["setting:autoform:"+o.value+":recovery"]},import:{show:!1,url:"autoform/import",templateUrl:"test/crontab/downloadTemplate",auth:["setting:autoform:"+o.value+":import"]},export:{show:!1,url:"autoform/export",auth:["setting:autoform:"+o.value+":export"]}}),l.value=!0}}).catch(e=>{console.error(e)});const x=(e,a,t)=>{let s={id:a,statusName:t,statusValue:e};u({url:"setting/autoform/changeStatus/"+o.value,method:"put",data:s}).then(n=>{n.success&&O.success(n.message)}).catch(n=>{console.log(n)})};return(e,a)=>{const t=i("a-spin"),s=i("a-switch"),n=i("ma-crud");return c(),R("div",S,[l.value===!1?(c(),h(t,{key:0,dot:""})):_("",!0),l.value===!0?(c(),h(n,{key:1,options:f(d),columns:f(m),ref_key:"crudRef",ref:g},{status:q(({record:p})=>[A(s,{"checked-value":1,"unchecked-value":"2",onChange:C=>x(C,p.id),"default-checked":p.status==1},null,8,["onChange","default-checked"])]),_:1},8,["options","columns"])):_("",!0)])}}});export{V as default};
