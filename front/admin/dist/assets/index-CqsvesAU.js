import{c as a,_ as T}from"./logList-DVnwizqy.js";import{k as u,S as m,r as s,fy as q,o as p,c as B,d as e,w as c,N as L,h as S,f as h,M as _}from"./index-Dj8CxrJe.js";const V={class:"ma-content-block lg:flex justify-between p-4"},M={name:"system:crontab"},$=Object.assign(M,{setup(N){const f=u(),l=u(),g=[{label:"命令任务",value:1},{label:"类任务",value:2},{label:"URL任务",value:3},{label:"PHP脚本任务",value:4}],y=async(t,o)=>{const r=await a.changeStatus({id:o,status:t});r.success&&_.success(r.message)},w=async t=>{const o=await a.run({id:t.id});o.success&&_.success(o.message)},x=t=>{l.value.open(t.id)},v=m({api:a.getPageList,showIndex:!1,pageLayout:"fixed",rowSelection:{showCheckedAll:!0},operationColumn:!0,operationColumnWidth:280,add:{show:!0,api:a.save,auth:["setting:crontab:save"]},edit:{show:!0,api:a.update,auth:["setting:crontab:update"]},delete:{show:!0,api:a.deletes,auth:["setting:crontab:delete"]}}),k=m([{title:"ID",dataIndex:"id",addDisplay:!1,editDisplay:!1,width:50,hide:!0},{title:"任务名称",dataIndex:"name",search:!0,commonRules:[{required:!0,message:"任务名称必填"}],width:200},{title:"任务类型",dataIndex:"type",search:!0,commonRules:[{required:!0,message:"任务类型必选"}],dict:{data:g,translation:!0},formType:"select",width:150},{title:"定时规则",dataIndex:"rule",commonRules:[{required:!0,message:"定时规则必填"}],extra:"例如：30 */5 * * * *，代表每隔5分钟的第30秒执行任务",width:150},{title:"调用目标",dataIndex:"target",formType:"textarea",commonRules:[{required:!0,message:"调用目标必填"}],width:260},{title:"任务参数",dataIndex:"parameter",formType:"textarea",width:200,hide:!0},{title:"单次执行",dataIndex:"singleton",formType:"radio",addDefaultValue:2,dict:{data:[{label:"是",value:1},{label:"否",value:2}]},hide:!0},{title:"状态",dataIndex:"status",search:!0,formType:"radio",dict:{name:"data_status",props:{label:"title",value:"key"}},addDefaultValue:1,width:120},{title:"备注",dataIndex:"remark",hide:!0,formType:"textarea"},{title:"创建时间",dataIndex:"created_at",addDisplay:!1,editDisplay:!1,search:!0,formType:"range",width:180}]);return(t,o)=>{const r=s("a-switch"),b=s("icon-caret-right"),d=s("a-link"),I=s("a-popconfirm"),C=s("icon-history"),D=s("ma-crud"),R=q("auth");return p(),B("div",V,[e(D,{options:v,columns:k,ref_key:"crudRef",ref:f},{status:c(({record:n})=>[e(r,{"checked-value":1,"unchecked-value":"2",onChange:i=>y(i,n.id),"default-checked":n.status==1},null,8,["onChange","default-checked"])]),operationBeforeExtend:c(({record:n})=>[e(I,{content:"确定立刻执行一次?",position:"bottom",onOk:i=>w(n)},{default:c(()=>[L((p(),S(d,null,{default:c(()=>[e(b),h(" 执行一次")]),_:1})),[[R,["setting:crontab:run"]]])]),_:2},1032,["onOk"]),e(d,{onClick:i=>x(n)},{default:c(()=>[e(C),h(" 日志 ")]),_:2},1032,["onClick"])]),_:1},8,["options","columns"]),e(T,{ref_key:"logsRef",ref:l},null,512)])}}});export{$ as default};
