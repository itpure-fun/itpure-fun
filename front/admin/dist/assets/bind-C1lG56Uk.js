import{X as s,k as f,r as n,o as d,h as k,w as l,f as i,d as p,l as P,c as w,F as B,g as x,t as D,W as R,M as W}from"./index-Dj8CxrJe.js";import{a as X}from"./apiGroup-BEqWl0hU.js";const U={getList(e={}){return s({url:"system/app/index",method:"get",params:e})},getRecycleList(e={}){return s({url:"system/app/recycle",method:"get",params:e})},save(e={}){return s({url:"system/app/save",method:"post",data:e})},read(e){return s({url:"system/app/read/"+e,method:"post"})},deletes(e){return s({url:"system/app/delete",method:"delete",data:e})},recoverys(e){return s({url:"system/app/recovery",method:"put",data:e})},realDeletes(e){return s({url:"system/app/realDelete",method:"delete",data:e})},update(e,y={}){return s({url:"system/app/update/"+e,method:"put",data:y})},getAppId(){return s({url:"system/app/getAppId",method:"get"})},getAppSecret(){return s({url:"system/app/getAppSecret",method:"get"})},bind(e,y={}){return s({url:"system/app/bind/"+e,method:"put",data:y})},getBindApiList(e={}){return s({url:"system/app/getApiList",method:"get",params:e})},changeStatus(e={}){return s({url:"system/app/changeStatus",method:"put",data:e})}},$={class:"w-full"},H={__name:"bind",setup(e,{expose:y}){const A=f(!1),V=f(!0),g=f(),m=f([]),u=f([]),r=f([]),I=async t=>{g.value=t,A.value=!0,u.value=[],await E(),await G(),V.value=!1},q=async t=>{const a=[];if(u.value.map(o=>a.push(...o)),g.value){const o=await U.bind(g.value,{apiIds:R.uniq(a)});if(o.success){W.success(o.message),t(!0);return}t(!1)}t(!1)},E=async()=>{const t=await X.getSelectList({getApiList:!0});m.value=t.data,m.value.forEach(a=>{u.value.push([]),r.value.push(!1)})},G=async()=>{const t=await U.getBindApiList({id:g.value});t.success&&t.data.length>0&&t.data.map(a=>{m.value.map((o,_)=>{o.apis.map(async b=>{b.id==a&&u.value[_].push(b.id)}),u.value[_].length==o.apis.length&&(r.value[_]=!0)})})},L=(t,a)=>{r.value[t]?a.map(o=>{u.value[t].push(o.id)}):u.value[t]=[]},M=()=>{m.value.map((t,a)=>{r.value[a]=!0,L(a,t.apis)})},N=()=>{m.value.map((t,a)=>{r.value[a]=!1,u.value[a]=[]})};return y({open:I}),(t,a)=>{const o=n("icon-select-all"),_=n("a-button"),b=n("icon-eraser"),C=n("a-space"),S=n("a-checkbox"),j=n("a-checkbox-group"),F=n("a-empty"),O=n("a-spin"),T=n("a-drawer");return d(),k(T,{visible:A.value,"onUpdate:visible":a[0]||(a[0]=v=>A.value=v),width:"800px","on-before-ok":q,"ok-text":"保存绑定"},{title:l(()=>[i("绑定接口")]),default:l(()=>[p(O,{loading:V.value,tip:"数据加载中...",class:"w-full h-full"},{default:l(()=>[P("div",$,[p(C,null,{default:l(()=>[p(_,{type:"primary",onClick:M},{icon:l(()=>[p(o)]),default:l(()=>[i("全选")]),_:1}),p(_,{type:"primary",onClick:N},{icon:l(()=>[p(b)]),default:l(()=>[i("清除")]),_:1})]),_:1}),(d(!0),w(B,null,x(m.value,(v,h)=>(d(),w("div",{key:h,class:"mt-5 p-3 rounded flex flex-col",style:{border:"1px solid var(--color-border-2)"}},[p(C,null,{default:l(()=>[i(D(v.name)+" ",1),p(S,{modelValue:r.value[h],"onUpdate:modelValue":c=>r.value[h]=c,onChange:c=>L(h,v.apis)},{default:l(()=>[i("全选")]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1024),v.apis.length>0?(d(),k(j,{key:0,class:"mt-3",modelValue:u.value[h],"onUpdate:modelValue":c=>u.value[h]=c},{default:l(()=>[(d(!0),w(B,null,x(v.apis,(c,z)=>(d(),k(S,{key:z,value:c.id},{default:l(()=>[i(D(c.name),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):(d(),k(F,{key:1},{default:l(()=>[i("暂无接口")]),_:1}))]))),128))])]),_:1},8,["loading"])]),_:1},8,["visible"])}}},Q=Object.freeze(Object.defineProperty({__proto__:null,default:H},Symbol.toStringTag,{value:"Module"}));export{H as _,U as a,Q as b};
