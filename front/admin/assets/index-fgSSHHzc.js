import{k as n,A as z,q as G,a7 as J,S as V,M as m,r,fy as Q,o as i,c as x,l as k,d,fB as X,w as s,f as u,i as P,e as Y,h as f,N as b,F as Z,g as ee,t as te,fA as ae}from"./index-CeUf7hzR.js";import{d as se}from"./dept-B-4ODiIu.js";import{u as o}from"./user-D2kyxwaZ.js";const oe={class:"ma-content-block lg:flex justify-between p-4"},re={class:"lg:w-2/12 w-full h-full p-2 shadow"},le={class:"lg:w-10/12 w-full lg:ml-4 mt-5 lg:mt-0"},de=["src"],ie={key:0},ne={name:"system:user"},fe=Object.assign(ne,{setup(ue){const I=n([{label:"所有部门",value:0}]),D=n([]),p=n(),h=n(!1),C=n(),_=n(""),y=n([0]);z(()=>{se.tree().then(e=>{e.data.map(t=>{I.value.push(t)})}),G.getDict("dashboard").then(e=>D.value=e.data)});let R=J(()=>p.value?p.value.isRecovery:!1);const S=e=>{p.value.requestParams=e[0]===0?{dept_id:void 0}:{dept_id:e[0]},p.value.requestData(),y.value=e},A=async(e,t)=>{const l=await o.changeStatus({id:t,status:e});l.success&&m.success(l.message)},L=e=>{o.clearCache({id:e}).then(t=>{t.success&&m.success(t.message)})},q=e=>{o.initUserPassword({id:e}).then(t=>t.success&&m.success(t.message))},B=e=>{o.setHomePage({id:C.value,dashboard:_.value}).then(t=>{t.success&&m.success(t.message)}),e(!0)},N=(e,t)=>{if(e==="resetPassword"){ae.info({title:"提示",content:"确定将该用户密码重置为 123456 吗？",simple:!1,onBeforeOk:l=>{q(t),l(!0)}});return}if(e==="updateCache"){L(t);return}if(e==="setHomePage"){h.value=!0,C.value=t;return}},O=V({api:o.getPageList,recycleApi:o.getRecyclePageList,searchColNumber:3,showIndex:!1,pageLayout:"fixed",rowSelection:{showCheckedAll:!0},operationColumn:!0,operationColumnWidth:200,add:{show:!0,api:o.save,auth:["system:user:save"]},edit:{show:!0,api:o.update,auth:["system:user:update"]},delete:{show:!0,api:o.deletes,auth:["system:user:delete"],realApi:o.realDeletes,realAuth:["system:user:realDeletes"]},recovery:{show:!0,api:o.recoverys,auth:["system:user:recovery"]},import:{show:!0,url:"system/user/import",templateUrl:"system/user/downloadTemplate",auth:["system:user:import"]},export:{show:!0,url:"system/user/export",auth:["system:user:export"]},formOption:{width:800,layout:[{formType:"grid",cols:[{span:24,formList:[{dataIndex:"avatar"}]}]},{formType:"grid",cols:[{span:12,formList:[{dataIndex:"username"}]},{span:12,formList:[{dataIndex:"dept_ids"}]}]},{formType:"grid",cols:[{span:12,formList:[{dataIndex:"password"}]},{span:12,formList:[{dataIndex:"nickname"}]}]},{formType:"grid",cols:[{span:12,formList:[{dataIndex:"role_ids"}]},{span:12,formList:[{dataIndex:"phone"}]}]},{formType:"grid",cols:[{span:12,formList:[{dataIndex:"post_ids"}]},{span:12,formList:[{dataIndex:"email"}]}]},{formType:"grid",cols:[{span:24,formList:[{dataIndex:"status"}]}]},{formType:"grid",cols:[{span:24,formList:[{dataIndex:"remark"}]}]}]},isDbClickEdit:!1,beforeOpenEdit:e=>e.id===1?(m.error("创始人不可编辑"),!1):!0,beforeDelete:e=>e.includes(1)?(m.error("创始人不可删除"),!1):!0}),U=V([{title:"ID",dataIndex:"id",addDisplay:!1,editDisplay:!1,width:50,hide:!0},{title:"头像",dataIndex:"avatar",width:75,formType:"upload",returnType:"hash",type:"image",rounded:!0,labelWidth:"86px"},{title:"账户",dataIndex:"username",width:130,search:!0,addDisabled:!1,editDisabled:!0,commonRules:[{required:!0,message:"账户必填"}]},{title:"所属部门",dataIndex:"dept_ids",hide:!0,formType:"tree-select",multiple:!0,treeCheckable:!0,treeCheckStrictly:!0,dict:{url:"system/dept/tree"},commonRules:[{required:!0,message:"所属部门必选"}],editDefaultValue:async e=>(await o.read(e.id)).data.deptList.map(l=>l.id)},{title:"密码",dataIndex:"password",hide:!0,autocomplete:"off",addDefaultValue:"123456",editDefaultValue:"",addDisabled:!1,editDisabled:!0,type:"password",addRules:[{required:!0,message:"密码必填"}]},{title:"昵称",dataIndex:"nickname",width:120},{title:"角色",dataIndex:"role_ids",width:120,formType:"select",multiple:!0,dict:{url:"system/role/list",props:{label:"name",value:"id"}},hide:!0,commonRules:[{required:!0,message:"角色必选"}],editDefaultValue:async e=>(await o.read(e.id)).data.roleList.map(l=>l.id)},{title:"手机",dataIndex:"phone",width:150,search:!0,commonRules:[{match:/^1[3|4|5|6|7|8|9][0-9]\d{8}$/,message:"请输入正确的手机号码"}]},{title:"岗位",dataIndex:"post_ids",width:120,formType:"select",multiple:!0,dict:{url:"system/post/list",props:{label:"name",value:"id"}},hide:!0,editDefaultValue:async e=>(await o.read(e.id)).data.postList.map(v=>v.id)},{title:"邮箱",dataIndex:"email",width:200,search:!0,commonRules:[{type:"email",message:"请输入正确的邮箱"}]},{title:"状态",dataIndex:"status",width:100,search:!0,formType:"radio",dict:{name:"data_status",props:{label:"title",value:"key"}},addDefaultValue:"1",labelWidth:"86px"},{title:"备注",dataIndex:"remark",width:180,hide:!0,formType:"textarea",labelWidth:"86px"},{title:"注册时间",dataIndex:"created_at",width:180,addDisplay:!1,editDisplay:!1,search:!0,formType:"range"}]);return(e,t)=>{const l=r("a-switch"),v=r("a-avatar"),H=r("icon-refresh"),T=r("a-link"),M=r("icon-double-right"),g=r("a-doption"),j=r("a-dropdown"),E=r("ma-crud"),W=r("a-option"),$=r("a-select"),F=r("a-form-item"),K=r("a-modal"),w=Q("auth");return i(),x("div",oe,[k("div",re,[d(X,{data:I.value,searchPlaceholder:"搜索部门",modelValue:y.value,"onUpdate:modelValue":t[0]||(t[0]=a=>y.value=a),onClick:S},null,8,["data","modelValue"])]),k("div",le,[d(E,{options:O,columns:U,ref_key:"crudRef",ref:p},{status:s(({record:a})=>[d(l,{"checked-value":1,"unchecked-value":"2",onChange:c=>A(c,a.id),"default-checked":a.status==1},null,8,["onChange","default-checked"])]),avatar:s(({record:a})=>[d(v,null,{default:s(()=>[k("img",{src:a.avatar?e.$tool.showFile(a.avatar):e.$url+"avatar.jpg",style:{"object-fit":"cover"}},null,8,de)]),_:2},1024)]),operationCell:s(({record:a})=>[a.id==1?(i(),x("div",ie,[d(T,{onClick:c=>L(a.id)},{default:s(()=>[d(H),u(" 更新缓存")]),_:2},1032,["onClick"])])):P("",!0)]),operationAfterExtend:s(({record:a})=>[a.id!=1&&!Y(R)?(i(),f(j,{key:0,trigger:"hover",onSelect:c=>N(c,a.id)},{content:s(()=>[b((i(),f(g,{value:"updateCache"},{default:s(()=>[u("更新缓存")]),_:1})),[[w,["system:user:cache"]]]),b((i(),f(g,{value:"setHomePage"},{default:s(()=>[u("设置首页")]),_:1})),[[w,["system:user:homePage"]]]),b((i(),f(g,{value:"resetPassword"},{default:s(()=>[u("重置密码")]),_:1})),[[w,["system:user:initUserPassword"]]])]),default:s(()=>[d(T,null,{default:s(()=>[d(M),u(" 更多")]),_:1})]),_:2},1032,["onSelect"])):P("",!0)]),_:1},8,["options","columns"])]),d(K,{visible:h.value,"onUpdate:visible":t[2]||(t[2]=a=>h.value=a),onBeforeOk:B},{title:s(()=>[u("设置用户后台首页")]),default:s(()=>[d(F,{label:"用户首页"},{default:s(()=>[d($,{modelValue:_.value,"onUpdate:modelValue":t[1]||(t[1]=a=>_.value=a),placeholder:"请选择用户首页"},{default:s(()=>[(i(!0),x(Z,null,ee(D.value,(a,c)=>(i(),f(W,{key:c,value:a.key},{default:s(()=>[u(te(a.title),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["visible"])])}}});export{fe as default};
