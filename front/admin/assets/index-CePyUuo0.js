import{X as g,_ as oe,v as ne,k as f,A as se,q as j,S as P,r as o,o as i,c as I,l as d,d as a,fB as le,w as e,h as p,f as v,i as R,F as ce,g as ie,e as q,m as A,t as y,M as x,fC as de}from"./index-CeUf7hzR.js";const w={getPageList(s={}){return g({url:"system/attachment/index",method:"get",params:s})},getRecyclePageList(s={}){return g({url:"system/attachment/recycle",method:"get",params:s})},deletes(s){return g({url:"system/attachment/delete",method:"delete",data:s})},recoverys(s){return g({url:"system/attachment/recovery",method:"put",data:s})},realDeletes(s){return g({url:"system/attachment/realDelete",method:"delete",data:s})}},re={class:"ma-content-block lg:flex justify-between p-4"},ue={class:"lg:w-2/12 w-full h-full p-2 shadow"},_e={class:"lg:w-10/12 w-full lg:ml-4 mt-5 lg:mt-0"},me={class:"actions"},pe=["onClick"],he={class:"action"},ge={name:"system:attachment"},fe=Object.assign(ge,{setup(s){ne.useI18n();const r=f(),u=f("list"),C=f(["all"]),D=f([]),_=f([]);se(async()=>{const t=await j.getDict("attachment_type");t.data.unshift({title:"所有",key:"all"}),D.value=t.data});const N=async t=>{C.value=t;const l=t[0]==="all"?void 0:t[0];r.value.requestParams.mime_type=l,r.value.refresh()},T=()=>{u.value=u.value==="list"?"window":"list"},L=async t=>{let l="",h=k(t.storage_mode);h!=="LOCAL"?(x.info("处理中..."),l=upload.storage[h]+t.url):(x.info("请求服务器下载文件中..."),l="system/downloadById?id="+t.id);const m=await j.download(l,"get");m?(A.download(m,h!=="LOCAL"?t.origin_name:""),x.success("请求成功，文件开始下载")):x.error("文件下载失败")},$=t=>{_.value=t,r.value.setSelecteds(t)},U=()=>{r.value.getTableData().map(t=>_.value.push(t.id)),r.value.setSelecteds(_.value)},E=()=>{_.value=[],r.value.setSelecteds([])},k=t=>de.storageMode[t.toString()],O=P({api:w.getPageList,recycleApi:w.getRecyclePageList,searchColNumber:3,requestParams:{},showIndex:!1,pageLayout:"fixed",rowSelection:{showCheckedAll:!0},operationColumn:!0,operationColumnWidth:200,delete:{show:!0,api:w.deletes,auth:["system:attachment:delete"],realApi:w.realDeletes,realAuth:["system:attachment:realDeletes"]},recovery:{show:!0,api:w.recoverys,auth:["system:attachment:recovery"]},isDbClickEdit:!1}),z=P([{title:"预览",dataIndex:"url",width:80},{title:"存储名称",dataIndex:"object_name",width:220},{title:"原文件名",dataIndex:"origin_name",width:150,search:!0},{title:"存储模式",dataIndex:"storage_mode",width:100,search:!0,formType:"select",dict:{name:"upload_mode",props:{label:"title",value:"key"},translation:!0}},{title:"资源类型",dataIndex:"mime_type",width:130},{title:"存储目录",dataIndex:"storage_path",width:130},{title:"文件大小",dataIndex:"size_info",width:130},{title:"上传时间",dataIndex:"created_at",width:180,search:!0,formType:"range"}]);return(t,l)=>{const h=o("icon-select-all"),m=o("a-button"),V=o("icon-eraser"),F=o("a-input-group"),K=o("icon-apps"),W=o("icon-list"),b=o("a-tooltip"),X=o("icon-check"),G=o("a-tag"),H=o("a-checkbox"),S=o("icon-download"),J=o("icon-info-circle"),B=o("a-image"),Q=o("a-space"),Y=o("a-image-preview-group"),Z=o("a-checkbox-group"),ee=o("a-avatar"),te=o("a-link"),ae=o("ma-crud");return i(),I("div",re,[d("div",ue,[a(le,{data:D.value,"search-placeholder":t.$t("maResource.searchResource"),"field-names":{title:"title",key:"key"},onClick:N,icon:"icon-folder",modelValue:C.value,"onUpdate:modelValue":l[0]||(l[0]=c=>C.value=c)},null,8,["data","search-placeholder","modelValue"])]),d("div",_e,[a(ae,{options:O,columns:z,ref_key:"crudRef",ref:r},{tableAfterButtons:e(()=>[u.value==="window"?(i(),p(F,{key:0},{default:e(()=>[a(m,{onClick:U},{icon:e(()=>[a(h)]),default:e(()=>[v("全选")]),_:1}),a(m,{onClick:E},{icon:e(()=>[a(V)]),default:e(()=>[v("清除")]),_:1})]),_:1})):R("",!0)]),tools:e(()=>[a(b,{content:u.value==="list"?"切换橱窗模式":"切换列表模式"},{default:e(()=>[a(m,{shape:"circle",onClick:T},{default:e(()=>[u.value==="list"?(i(),p(K,{key:0})):(i(),p(W,{key:1}))]),_:1})]),_:1},8,["content"])]),crudContent:e(c=>[u.value==="window"?(i(),p(Z,{key:0,modelValue:_.value,"onUpdate:modelValue":l[1]||(l[1]=n=>_.value=n),onChange:$},{default:e(()=>[a(Y,{infinite:""},{default:e(()=>[a(Q,{class:"window-list"},{default:e(()=>[(i(!0),I(ce,null,ie(c,n=>(i(),I("div",{key:n.id,class:"mb-2 image-content"},[a(H,{value:n.id,class:"checkbox"},{checkbox:e(({checked:M})=>[a(G,{checked:M,color:"blue",checkable:""},{default:e(()=>[a(X),v(" 选择")]),_:2},1032,["checked"])]),_:2},1032,["value"]),a(B,{width:"190",height:"190","show-loader":"",title:n.object_name,description:`大小：${n.size_info}`,src:/image/g.test(n.mime_type)?q(A).attachUrl(n.url,k(n.storage_mode)):t.$url+"not-image.png"},{extra:e(()=>[d("div",me,[a(b,{content:"下载此文件"},{default:e(()=>[d("span",{class:"action",onClick:M=>L(n)},[a(S)],8,pe)]),_:2},1024),a(b,null,{content:e(()=>[d("div",null,"存储名称："+y(n.object_name),1),d("div",null,"存储目录："+y(n.storage_path),1),d("div",null,"上传时间："+y(n.created_at),1),d("div",null,"存储模式："+y(k(n.storage_mode)),1)]),default:e(()=>[d("span",he,[a(J)])]),_:2},1024)])]),_:2},1032,["title","description","src"])]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["modelValue"])):R("",!0)]),url:e(({record:c})=>[/image/g.test(c.mime_type)?(i(),p(B,{key:0,class:"list-image",width:"40px",height:"40px",src:q(A).attachUrl(c.url,k(c.storage_mode))},null,8,["src"])):(i(),p(ee,{key:1,shape:"square",style:{top:"0px"}},{default:e(()=>[v(y(c.suffix),1)]),_:2},1024))]),operationBeforeExtend:e(({record:c})=>[a(te,{onClick:n=>L(c)},{default:e(()=>[a(S),v(" 下载")]),_:2},1032,["onClick"])]),_:1},8,["options","columns"])])])}}}),ye=oe(fe,[["__scopeId","data-v-de926409"]]);export{ye as default};
