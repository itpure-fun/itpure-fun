import{X as d,k as v,S as $,r as s,fy as T,o as r,c as j,d as l,w as o,N as h,h as g,f as i,l as b,t as C,M as u}from"./index-CeUf7hzR.js";const m={getPageList(a={}){return d({url:"setting/module/index",method:"get",params:a})},save(a={}){return d({url:"setting/module/save",method:"put",data:a})},deletes(a){return d({url:"setting/module/delete",method:"delete",data:a})},install(a){return d({url:"setting/module/install",method:"put",data:a})},modifyStatus(a={}){return d({url:"setting/module/modifyStatus",method:"post",data:a})}},U={class:"ma-content-block lg:flex justify-between p-4"},z={class:"mb-2"},A={class:"text-red-500 underline font-black"},W={class:"text-red-500"},X={name:"setting:module"},F=Object.assign(X,{setup(a){const k=v(),p=v(),y=v(!1),c=v({}),I=async e=>{if(e.name=="System"||e.name=="Setting")return u.info(e.label+" 是系统核心模块，不能操作"),!1;const t=e.enabled?"停用":"启用";(await m.modifyStatus({name:e.name,status:!e.enabled})).success&&u.success(`模块${t}成功`),k.value.refresh()},D=async e=>{if(e.name=="System"||e.name=="Setting")return u.info(e.label+" 是系统核心模块，不能操作"),!1;const t=await m.install({name:e.name});t.success&&u.success(t.message)},R=async e=>{if(p.value!==c.value.name){u.error("输入错误，验证失败"),e(!1);return}(await m.deletes({name:p.value})).success&&(u.success("模块删除成功"),k.value.refresh(),c.value={},e(!0))},V=async e=>{if(e.name=="System"||e.name=="Setting")return u.info(e.label+" 是系统核心模块，不能删除"),!1;c.value=e,y.value=!0},q=$({pk:"name",formExcludePk:!1,api:m.getPageList,showIndex:!1,searchColNumber:3,pageLayout:"fixed",operationColumn:!0,operationColumnWidth:240,add:{show:!0,api:m.save,auth:["setting:module:save"]}}),M=$([{title:"模块名称",dataIndex:"name",search:!0,width:120,placeholder:"请输入模块名称（英文标识）",commonRules:[{required:!0,message:"模块名称必填"},{validator:(e,t)=>{/^[A-Za-z]{2,}$/g.test(e)||t("模块必须是2位以上的英文")}}]},{title:"模块标签",dataIndex:"label",search:!0,width:120,placeholder:"请输入模块标签（中文名称）",commonRules:[{required:!0,message:"模块标签必填"}]},{title:"版本号",dataIndex:"version",width:100,placeholder:"请输入版本号",commonRules:[{required:!0,message:"版本号必填"},{validator:(e,t)=>{/^[0-9\.]{3,}$/g.test(e)||t("版本号必须包含数字和小数点")}}]},{title:"描述",dataIndex:"description",formType:"textarea",placeholder:"请输入模块的功能描述",width:400,commonRules:[{required:!0,message:"描述必填"}]},{title:"状态",dataIndex:"enabled",formType:"radio",addDisplay:!1,editDisplay:!1,width:120,dict:{data:[{label:"开启",value:!0},{label:"禁用",value:!1}],translation:!0}}]);return(e,t)=>{const x=s("icon-record"),f=s("a-link"),w=s("a-popconfirm"),N=s("icon-info-circle"),O=s("icon-check-circle"),B=s("icon-delete"),E=s("ma-crud"),L=s("a-input"),P=s("a-modal"),_=T("auth");return r(),j("div",U,[l(E,{options:q,columns:M,ref_key:"crudRef",ref:k},{operationCell:o(({record:n})=>[l(w,{onOk:S=>D(n),content:"确定安装模块数据？如表和数据已存在则可能无效！",position:"bottom"},{default:o(()=>[h((r(),g(f,null,{default:o(()=>[l(x),i(" 安装数据")]),_:1})),[[_,["setting:module:install"]]])]),_:2},1032,["onOk"]),l(w,{onOk:S=>I(n),content:`确定要${n.enabled?"停用":"启用"}${n.label}吗?`,position:"bottom"},{default:o(()=>[n.enabled?h((r(),g(f,{key:0},{default:o(()=>[l(N),i(" 停用")]),_:1})),[[_,["setting:module:status"]]]):h((r(),g(f,{key:1},{default:o(()=>[l(O),i(" 启用")]),_:1})),[[_,["setting:module:status"]]])]),_:2},1032,["onOk","content"]),h((r(),g(f,{onClick:S=>V(n)},{default:o(()=>[l(B),i(" 删除")]),_:2},1032,["onClick"])),[[_,["setting:module:delete"]]])]),_:1},8,["options","columns"]),l(P,{visible:y.value,"onUpdate:visible":t[1]||(t[1]=n=>y.value=n),type:"warning","on-before-ok":R},{title:o(()=>[i("危险操作")]),default:o(()=>[b("div",z,[i(" 确定要删除 "),b("span",A,C(c.value.label),1),i(" 模块吗？ ")]),b("div",null,[i(" 此操作会删除文件和数据表，如果执行请在下面输入框输入："),b("span",W,C(c.value.name),1)]),l(L,{placeholder:`请输入 ${c.value.name}`,class:"mt-2",modelValue:p.value,"onUpdate:modelValue":t[0]||(t[0]=n=>p.value=n)},null,8,["placeholder","modelValue"])]),_:1},8,["visible"])])}}});export{F as default};
