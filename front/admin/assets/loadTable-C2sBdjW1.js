import{d as N}from"./dataMaintain-CuQfJgm8.js";import{d as R}from"./datasource-Bj9J3zvb.js";import{g as I}from"./generate-Cwn7oav1.js";import{k as m,S as M,r as u,o as j,h as z,w as a,f as b,d as e,M as E,y as F}from"./index-CeUf7hzR.js";const Q={__name:"loadTable",emits:["success"],setup(G,{expose:S,emit:T}){const r=m(),p=m([]),_=m(!1),s=m("MineAdmin"),i=m({}),d=m({}),A=T,f=m([]);I.getDataSourceList().then(l=>{f.value=l.data.items,f.value.unshift({label:"系统数据源",value:"MineAdmin"})});const x=()=>{const l=v.find(c=>c.dataIndex==="new_name"),o=v.find(c=>c.dataIndex==="new_comment");s.value==="MineAdmin"?(l.hide=!0,o.hide=!0):(l.hide=!1,o.hide=!1),g.api=s.value==="MineAdmin"?N.getPageList:R.getDataSourceTablePageList,r.value.requestParams.id=s.value==="MineAdmin"?void 0:s.value,r.value.requestData()},U=async l=>{if(p.value.length<1){E.info("至少要选择一条数据"),l(!1);return}let o=[];r.value.getTableData().filter(t=>{p.value.includes(t.name)&&o.push({name:t.name,comment:t.comment,sourceName:t.name})}),o.map(t=>{d.value[t.sourceName]&&(t.comment=d.value[t.sourceName]),i.value[t.name]&&(t.name=i.value[t.name])});const c=await I.loadTable({source:s.value,names:o});A("success",c.success),p.value=[],l(!0)},L=l=>p.value=l,D=()=>{_.value=!0,F(()=>{x()})},g=M({pk:"name",autoRequest:!1,searchColNumber:1,api:N.getPageList,showIndex:!0,rowSelection:{showCheckedAll:!0,key:"name",onlyCurrent:!0}}),v=M([{title:"表名称",dataIndex:"name",search:!0,width:200},{title:"新名称",dataIndex:"new_name",hide:!0,width:200},{title:"表注释",dataIndex:"comment",width:180},{title:"新注释",dataIndex:"new_comment",hide:!0,width:180},{title:"创建时间",dataIndex:"create_time",width:180}]);return S({open:D}),(l,o)=>{const c=u("a-alert"),t=u("a-select"),P=u("a-button"),h=u("a-input-group"),k=u("a-input"),C=u("icon-copy"),V=u("a-link"),y=u("a-tooltip"),q=u("ma-crud"),B=u("a-modal");return j(),z(B,{width:"1100px",visible:_.value,"onUpdate:visible":o[1]||(o[1]=n=>_.value=n),"on-before-ok":U,"align-center":!1,top:"50px","unmount-on-close":""},{title:a(()=>[b("装载数据表")]),default:a(()=>[e(c,{class:"mb-3",closable:""},{default:a(()=>[b("非系统数据源，载入表时，会同步远程的表结构到本地数据库。建议重新命名表名称和表注释。但需要注意表名称的规范")]),_:1}),e(q,{options:g,columns:v,ref_key:"crudRef",ref:r,onSelectionChange:L},{tableButtons:a(()=>[e(h,null,{default:a(()=>[e(t,{placeholder:"切换数据源",modelValue:s.value,"onUpdate:modelValue":o[0]||(o[0]=n=>s.value=n),options:f.value,style:{width:"300px"}},null,8,["modelValue","options"]),e(P,{type:"primary",onClick:x},{default:a(()=>[b("确定切换")]),_:1})]),_:1})]),new_name:a(({record:n})=>[e(h,null,{default:a(()=>[e(k,{modelValue:i.value[n.name],"onUpdate:modelValue":w=>i.value[n.name]=w},null,8,["modelValue","onUpdate:modelValue"]),e(y,{content:"复制表名称到新名称"},{default:a(()=>[e(V,{onClick:()=>i.value[n.name]=n.name},{default:a(()=>[e(C)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),new_comment:a(({record:n})=>[e(h,null,{default:a(()=>[e(k,{modelValue:d.value[n.name],"onUpdate:modelValue":w=>d.value[n.name]=w},null,8,["modelValue","onUpdate:modelValue"]),e(y,{content:"复制表注释到新注释"},{default:a(()=>[e(V,{onClick:()=>d.value[n.name]=n.comment},{default:a(()=>[e(C)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:1},8,["options","columns"])]),_:1},8,["visible"])}}};export{Q as default};
